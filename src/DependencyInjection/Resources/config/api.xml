<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

  <services>
    <service id="api_platform.serializer" alias="serializer" />
    <service id="api_platform.property_accessor" alias="property_accessor" public="false" />
    <service id="api_platform.property_info" alias="property_info" public="false" />
    <service id="api_platform.negotiator" class="Negotiation\Negotiator" public="false" />

    <service id="api_platform.action.entrypoint" class="Drupal\api_platform\Core\Action\EntrypointAction" public="true">
      <argument type="service" id="api_platform.metadata.resource.name_collection_factory" />
    </service>

    <service id="api_platform.operation_method_resolver" class="Drupal\api_platform\Core\Routing\OperationMethodResolver" public="false">
      <argument type="service" id="api_platform.router" />
      <argument type="service" id="api_platform.metadata.resource.metadata_factory" />
    </service>

    <service id="api_platform.resource_class_resolver" class="Drupal\api_platform\Core\Api\ResourceClassResolver" public="false">
      <argument type="service" id="api_platform.metadata.resource.name_collection_factory" />
    </service>

    <service id="api_platform.formats_provider" class="Drupal\api_platform\Core\Api\FormatsProvider">
      <argument type="service" id="api_platform.metadata.resource.metadata_factory" />
      <argument>%api_platform.formats%</argument>
    </service>

    <service id="api_platform.router" class="Drupal\api_platform\Core\Routing\Router" public="false">
      <argument type="service" id="router" />
      <argument type="service" id="url_generator.non_bubbling" />
    </service>

    <service id="api_platform.operation_path_resolver.custom" class="Drupal\api_platform\Core\PathResolver\CustomOperationPathResolver" public="false">
      <argument type="service" id="api_platform.operation_path_resolver.generator" />
    </service>

    <service id="api_platform.operation_path_resolver.generator" class="Drupal\api_platform\Core\PathResolver\OperationPathResolver" public="false">
      <argument type="service" id="api_platform.path_segment_name_generator" />
    </service>

    <service id="api_platform.path_segment_name_generator.underscore" class="Drupal\api_platform\Core\Operation\UnderscorePathSegmentNameGenerator" public="false" />

    <!-- Resources Operations path resolver -->

    <service id="api_platform.operation_path_resolver" alias="api_platform.operation_path_resolver.router" public="false" />

    <service id="api_platform.operation_path_resolver.router" class="Drupal\api_platform\Core\Routing\RouterOperationPathResolver" public="false">
      <argument type="service" id="api_platform.router" />
      <argument type="service" id="api_platform.operation_path_resolver.custom" />
      <argument type="service" id="api_platform.subresource_operation_factory" />
    </service>

    <service id="api_platform.subresource_operation_factory" class="Drupal\api_platform\Core\Operation\Factory\SubresourceOperationFactory" public="false">
      <argument type="service" id="api_platform.metadata.resource.metadata_factory" />
      <argument type="service" id="api_platform.metadata.property.name_collection_factory" />
      <argument type="service" id="api_platform.metadata.property.name_collection_factory" />
      <argument type="service" id="api_platform.metadata.property.metadata_factory" />
      <argument type="service" id="api_platform.path_segment_name_generator" />
    </service>

    <service id="api_platform.iri_converter" class="Drupal\api_platform\Core\Routing\IriConverter" public="false">
      <argument type="service" id="api_platform.metadata.property.name_collection_factory" />
      <argument type="service" id="api_platform.metadata.property.metadata_factory" />
      <argument type="service" id="api_platform.item_data_provider" />
      <argument type="service" id="api_platform.route_name_resolver" />
      <argument type="service" id="api_platform.router" />
      <argument type="service" id="api_platform.property_accessor" />
<!--      <argument type="service" id="api_platform.identifiers_extractor.cached" />-->
      <argument type="service" id="api_platform.subresource_data_provider" on-invalid="ignore" />
      <argument type="service" id="api_platform.identifier.converter" on-invalid="ignore" />
      <argument type="service" id="api_platform.resource_class_resolver" />
    </service>

    <!-- Resources Operations path resolver -->

    <service id="api_platform.route_name_resolver" class="Drupal\api_platform\Core\Routing\RouteNameResolver" public="false">
      <argument type="service" id="api_platform.router" />
    </service>

    <!-- Event listeners -->

    <!-- kernel.request priority must be < 8 to be executed after the Firewall -->
    <service id="api_platform.listener.request.add_format" class="Drupal\api_platform\EventListener\AddFormatListener">
      <argument type="service" id="api_platform.negotiator" />
      <argument type="service" id="api_platform.formats_provider" />

      <tag name="event_subscriber"/>
    </service>

    <service id="api_platform.listener.view.respond" class="Drupal\api_platform\Core\EventListener\RespondListener">
      <argument type="service" id="api_platform.metadata.resource.metadata_factory" />
      <tag name="event_subscriber" />
    </service>

    <service id="api_platform.listener.view.serialize" class="Drupal\api_platform\Core\EventListener\SerializeListener">
      <argument type="service" id="api_platform.serializer" />
      <argument type="service" id="api_platform.serializer.context_builder" />
      <argument type="service" id="api_platform.metadata.resource.metadata_factory" />

      <tag name="event_subscriber" />
    </service>

    <service id="api_platform.listener.exception" class="Drupal\api_platform\Core\EventListener\ExceptionListener">
      <argument>api_platform.action.exception</argument>
      <argument type="service" id="logger" on-invalid="null" />

      <tag name="event_subscriber" />
<!--      <tag name="kernel.event_listener" event="kernel.exception" method="onKernelException" priority="-96" />-->
<!--      <tag name="monolog.logger" channel="request" />-->
    </service>

    <!-- Serializer -->

    <service id="api_platform.serializer.context_builder" class="Drupal\api_platform\Core\Serializer\SerializerContextBuilder" public="false">
      <argument type="service" id="api_platform.metadata.resource.metadata_factory" />
    </service>

    <!-- Identifiers -->

    <service id="api_platform.identifiers_extractor" class="Drupal\api_platform\Core\Api\IdentifiersExtractor" public="false">
      <argument type="service" id="api_platform.metadata.property.name_collection_factory" />
      <argument type="service" id="api_platform.metadata.property.metadata_factory" />
      <argument type="service" id="api_platform.property_accessor" />
      <argument type="service" id="api_platform.resource_class_resolver" />
    </service>

<!--    <service id="api_platform.identifiers_extractor.cached" class="Drupal\api_platform\Core\Api\CachedIdentifiersExtractor" decorates="api_platform.identifiers_extractor" public="false">-->
<!--&lt;!&ndash;      <argument type="service" id="api_platform.cache.identifiers_extractor"  />&ndash;&gt;-->
<!--      <argument type="service" id="api_platform.identifiers_extractor.cached.inner" />-->
<!--      <argument type="service" id="api_platform.property_accessor" />-->
<!--      <argument type="service" id="api_platform.resource_class_resolver" />-->
<!--    </service>-->

    <!-- Cache -->

<!--    <service id="api_platform.cache.identifiers_extractor" parent="cache.system" public="false">-->
<!--      <tag name="cache.pool" />-->
<!--    </service>-->


    <!-- Action -->

    <service id="api_platform.action.placeholder" class="Drupal\api_platform\Core\Action\PlaceholderAction" public="true" />
    <service id="api_platform.action.get_collection" alias="api_platform.action.placeholder" public="true" />
    <service id="api_platform.action.post_collection" alias="api_platform.action.placeholder" public="true" />
    <service id="api_platform.action.get_item" alias="api_platform.action.placeholder" public="true" />
    <service id="api_platform.action.patch_item" alias="api_platform.action.placeholder" public="true" />
    <service id="api_platform.action.put_item" alias="api_platform.action.placeholder" public="true" />
    <service id="api_platform.action.delete_item" alias="api_platform.action.placeholder" public="true" />

    <service id="api_platform.action.exception" class="Drupal\api_platform\Core\Action\ExceptionAction" public="true">
      <argument type="service" id="api_platform.serializer" />
      <argument>%api_platform.error_formats%</argument>
      <argument>%api_platform.exception_to_status%</argument>
    </service>

  </services>
</container>
